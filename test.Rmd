---
title: "test"
author: "Qixiang Chen"
date: "2023-07-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
source("tfci.R")
source("tcheckTriple.R")
source("tpc.cons.intern.R")
source("tpdsep.R")
source("tskeleton.R")
```

1. Case1
```{r}
set.seed(1234)
n <- 10000

L1 <- rnorm(n, 0, 1)

X2 <- rnorm(n, 3.1 + 1.2*L1, 1)  #X2

X3 <- rnorm(n, 5.5 + 2.7*L1, 1)  #X3

L2 <- rnorm(n, 1.9 + 2.8*X3, 1)

X4 <- rnorm(n, 3.1*X2 + 1.6*L2, 1)  #X4

X1 <- rnorm(n, 4.1*X3 - 2.5*L2, 1)  #X1 is in a future tier, where all else vertices are in the same previous tier to X1.

data <- cbind(X2,X3,X4,X1) ## L is not observed in data

indepTest <- gaussCItest ## specify the independence test
suffStat <- list(C = cor(data), n = n) ## using the correlation matrix


#Normal FCI result
fci.est1 <- fci(suffStat, indepTest, alpha = 0.05, p = 4, verbose=TRUE) ## estimate a PAG
plot(fci.est1)
```



```{r}
#TFCI result
tfci.trial1 <- tfci(suffStat, indepTest, alpha = 0.05, p = 4, verbose=FALSE, tiers = c(1, 1, 1, 2)) ## estimate a PAG
#plot(tfci.trial)

tfci.trial1@amat
```


```{r}
plot(tfci.trial1)
```




2. Case2
```{r}
set.seed(1234)
n <- 10000
X1 <- rnorm(n, 0, 1)  #X1
X2 <- rnorm(n, 0, 1)  #Z1

L1 <- rnorm(n, 0, 1)
L2 <- rnorm(n, 0, 1)

X3 <- rnorm(n, 1.7*L1 + 1.3*L2, 1)  #Y1


X4 <- rnorm(n, -3 + 2.8 + 1.9*L1, 1)  #X2
X5 <- rnorm(n, -1 + 2.2 + 2.3*L2, 1)  #Z2
X6 <- rnorm(n, 0, 1)  #Y2



data <- cbind(X1,X2,X3,X4,X5,X6) ## L is not observed in data


indepTest <- gaussCItest ## specify the independence test
suffStat <- list(C = cor(data), n = n) ## using the correlation matrix


#Normal FCI result
fci.est2 <- fci(suffStat, indepTest, alpha = 0.05, p = 6, verbose=TRUE) ## estimate a PAG
plot(fci.est2)
```



```{r}
#TFCI result
tfci.trial2 <- tfci(suffStat, indepTest, alpha = 0.05, p = 6, verbose=FALSE, tiers = c(1, 1, 1, 2, 2, 2)) ## estimate a PAG
#plot(tfci.trial)

tfci.trial2@amat
```



```{r}
plot(tfci.trial2)
```